/*
 *	Title:		jquery.one-hot-minute (oneHotMinute)
 *	Homepage:	https://github.com/benichu/jquery.one-hot-minute
 *	Build:		1.0.0-20122412
 *	Copyright:	(c)2012: Benjamin Thouret <ben@2ret.com>
 *	License:	MIT, https://github.com/benichu/jquery.one-hot-minute/LICENSE-MIT
 *
 */
jQuery(function(){return $.oneHotMinute=function(e,t){var n,r,i=this;return r="waiting",this.settings={},this.$element=$(e),this.setState=function(e){return r=e},this.getState=function(){return r},this.getSetting=function(e){return this.settings[e]},this.callSettingFunction=function(e,t){return t==null&&(t=[]),this.settings[e].apply(this,t)},this.minutesToHours=function(e){var t,r,s,o,u;return n("applying minutesToHours"),s=parseInt(e.attr(i.settings.dataAttr)||0),u=s<0?"-":"",s=Math.abs(s),t=Math.floor(s/60),r=s%60,r=i._zeroFill(r,2),o=u+t+"h"+r,e.attr("value")!=null?e.attr("value",o):e.html(o)},this.valueToMinutes=function(e){var t,r,s,o,u,a;return n("valueToMinutes"),o=0,a="",e.attr("value")!=null&&e.val()&&(u=i._trimWhitespace(e.attr("value")),u=u.toLowerCase(),a=u.substr(0,1)==="-"?"-":"",t=Math.max(u.indexOf(":"),u.indexOf("h")),t>-1?(r=t>0?u.substr(0,t):0,s=t<u.length?u.substr(t+1,2):0,o=parseInt(r)*60+parseInt(s)):(o=parseFloat(i._normalizeDecimalSeparator(u))*60,a="")),e.attr(i.settings.saveAttr,a+o)},this._normalizeDecimalSeparator=function(e){return e==null&&(e=""),e.replace(/,/,".")},this._trimWhitespace=function(e){return e==null&&(e=""),e.replace(/^\s+|\s+$/g,"")},this._zeroFill=function(e,t){return e==null&&(e=""),t-=e.toString().length,t>0?(new Array(t+(/\./.test(e)?2:1))).join("0")+e:e+""},n=function(e){if(i.settings.debug)return typeof console!="undefined"&&console!==null?console.log(e):void 0},this.init=function(){var e,r;this.settings=$.extend({},this.defaults,t),this.setState("waiting");if(this.$element.length){n("Element is defined."),n("processableElements: "+this.settings.processableElements),this.$processableElements=this.$element.find(this.settings.processableElements.toString())||this.$element,r=this.settings,e=this,n("processMethod: "+this.settings.processMethod);switch(this.settings.processMethod){case"minutesToHours":this.$processableElements.each(function(){return e.minutesToHours($(this))}),this.setState("ready");break;case"valueToMinutes":this.$processableElements.each(function(){return e.valueToMinutes($(this)),$(this).bind("blur",function(){return e.valueToMinutes($(this)),e.callSettingFunction("onBlur",[$(this)])})}),this.setState("ready");break;default:this.setState("error")}return this.getState()==="ready"?this.callSettingFunction("onReady",[this.$element]):this.callSettingFunction("onError",[this.$element])}},this.init(),this},$.oneHotMinute.prototype.defaults={debug:!1,processMethod:"minutesToHours",processableElements:["span","input"],dataAttr:"data-minute",saveAttr:"data-minute",onReady:function(){},onError:function(){},onBlur:function(){}},$.fn.oneHotMinute=function(e){return this.each(function(){var t;if($(this).data("oneHotMinute")===void 0)return t=new $.oneHotMinute(this,e),$(this).data("oneHotMinute",t)})}});